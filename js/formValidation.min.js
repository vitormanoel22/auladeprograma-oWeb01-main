import{saveCadastro,getAllCadastros as t,removeCadastro}from"./store.js";import{showToast}from"./ui.js";export function initFormHandler(){const e=document.getElementById("form-cadastro");e&&(e.addEventListener("submit",n),e.addEventListener("input",o),document.getElementById("saved-entries")?.addEventListener("click",e=>{const n=e.target.closest("[data-remove-id]");if(n){const e=n.getAttribute("data-remove-id");removeCadastro(e),r(),showToast("Cadastro removido.")}}))}function o(e){const n=e.target;if("nome"===n.name){const e=n.closest(".form-row").querySelector(".form-feedback");n.value.trim().length<3?e.textContent="Nome muito curto":e.textContent=""}if("email"===n.name){const e=n.closest(".form-row").querySelector(".form-feedback");u(n.value)?e.textContent="":e.textContent="Formato de email inválido"}}function n(e){e.preventDefault();const n=e.target,o=n.nome.value.trim(),a=n.email.value.trim(),s=n.mensagem.value.trim();let d=!0;c(n),o.length<3?(l(n.nome,"Informe um nome com pelo menos 3 caracteres."),d=!1):/\d/.test(o)&&(l(n.nome,"Nome não pode conter números."),d=!1),u(a)?f(a)||(l(n.email,"Use um email com domínio comum (ex: gmail, outlook, hotmail, ongpet.org.br)."),d=!1):(l(n.email,"Informe um email válido (ex: nome@dominio.com)."),d=!1),s&&s.length>0&&s.length<10&&(l(n.mensagem,"Se enviar mensagem, escreva pelo menos 10 caracteres."),d=!1);if(d){const e=a.split("@")[1]||"";e.endsWith("corporate.com")&&s.length<20&&(l(n.mensagem,"Para emails corporativos, descreva seu interesse (>=20 caracteres)."),d=!1)}if(!d)return void showToast("Há erros no formulário. Corrija e tente novamente.");saveCadastro({nome:o,email:a,mensagem:s,createdAt:(new Date).toISOString()}),showToast("Cadastro salvo com sucesso!"),n.reset(),r()}function c(e){e.querySelectorAll(".form-feedback").forEach(e=>e.textContent="")}function l(e,n){const o=e.closest(".form-row").querySelector(".form-feedback");o.textContent=n,e.focus(),e.classList.add("input-error"),setTimeout(()=>e.classList.remove("input-error"),800)}function u(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function f(e){const n=["gmail.com","hotmail.com","outlook.com","yahoo.com","ongpet.org.br"],o=(e.split("@")[1]||"").toLowerCase();return n.some(e=>o===e||o.endsWith("."+e))}export function renderSavedList(){const e=document.getElementById("saved-entries");if(!e)return;const n=t();if(!n.length)return void(e.innerHTML="<p>Nenhum cadastro salvo ainda.</p>");e.innerHTML=n.map(e=>i(e)).join("")}function i(e){const t=g(e.nome),n=g(e.email),o=g(e.mensagem||"");return`<div class="card saved-item" style="margin-bottom:var(--space-2);"><strong>${t}</strong><div>${n}</div>${o?`<p>${o}</p>`:""}<div style="margin-top:0.5rem;"><button class="btn" data-remove-id="${e.id}" type="button">Remover</button></div></div>`}import*as Store from"./store.js";const{getAllCadastros}=Store;export{getAllCadastros};function g(e){return String(e||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}
